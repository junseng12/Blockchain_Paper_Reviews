# 📘 QAP 구조 완전 해설: 곱셈 제약 a·b = c 예제 기반

---

## 🔍 Q1. `w` 값은 왜 존재하고 어디에 쓰이나요?

### ✅ w란?

- `w`는 회로 내 모든 와이어(wire)들의 **값(value)**을 모아 놓은 벡터입니다.
- 예: `[1, a, b, c, d, ...]`
  - `1`은 항상 상수항(constant 1)을 위한 위치
  - 그 뒤는 각각 와이어의 실제 값들

### ✅ 왜 필요한가?

- zk-SNARK은 회로의 제약 조건을 만족하는 값 세트를 "증명자"가 알고 있음을 증명해야 해요
- 이 값들(witness)을 기반으로 `p(x)` 다항식을 만들고, `g^{p(s)}`를 생성함

---

## 🔍 Q2. 왜 a = [0,1,0,0]이 QAP에서는 1, 0, 0으로 변환되나요?

### ✅ R1CS 표현

- 각 제약은 다음의 형태로 표현됩니다:
  ```bash
  ⟨a, w⟩ · ⟨b, w⟩ = ⟨c, w⟩
  ```
- 여기서 ⟨a, w⟩는 각 원소별 곱의 합 (내적)입니다

### ✅ 변환 과정

- QAP에서는 각 와이어 위치마다 하나의 다항식이 존재합니다:
  - `L_i(x)`, `R_i(x)`, `O_i(x)` ← 각각 왼쪽, 오른쪽, 출력 다항식
- a = [0,1,0,0] 이란: 두 번째 와이어만 참여한다는 의미
  - → 그러면 `L_1(x)`만 `1`, 나머지는 0으로 설정

---

## 🔍 Q3. "제약이 하나뿐이라 x=1에서만 만족하면 된다"는 무슨 뜻인가요?

### ✅ QAP은 어떤 x에서 t(x) = 0이어야 함

- `t(x)`는 vanishing polynomial (소거 다항식)
- 제약이 1개 → 1개의 x 값(보통 x=1)만 있으면 됨

→ 따라서 t(x) = x - 1  
→ 우리가 만든 `p(x)`는 반드시 `p(1) = 0`이 되어야 함  
→ 즉, 제약 조건이 **x=1에서만 만족**하면 OK

### ✅ 소거 다항식 (Vanishing Polynomial)이란?

#### 📌 정의

`vanishing polynomial`은 어떤 고정된 점 집합에서 **0이 되도록 정의된 다항식**입니다.

예를 들어,

- 제약이 단 하나고, 해당 제약이 만족되어야 하는 x = 1이라면:

  $$
  t(x) = x - 1 \Rightarrow t(1) = 0
  $$

- 제약이 2개고, x = 1, x = 2 두 지점에서 각각 제약을 만족해야 한다면:

  $$
  t(x) = (x - 1)(x - 2)
  \Rightarrow t(1) = 0,\ t(2) = 0
  $$

> 즉, "이 다항식은 제약 위치에서만 0이 되고, 그 외에서는 0이 아니다"

### ✅ 특정 위치에서 0이 된다는 것"의 의미

#### 🧠 QAP 구조 목표:

$$
p(x) = L(x) \cdot R(x) - O(x)
$$

이 $p(x)$가 **모든 제약 위치 $x = r_i$ 에서 0이 되도록** 강제하는 게 핵심입니다.

#### "0이 되는 것"을 기준으로 삼는 이유:

##### 📌 이유 1: **수학적으로 “제약을 만족한다”는 의미는 식의 결과가 0이 된다는 것**

- 예:

  - `a * b = c`
  - 식을 정리하면 `a * b - c = 0` => p(x)로 만들었음

→ 이처럼 **모든 회로 제약은 결국 "식의 결과가 0이 되어야 한다"는 형태로 표현 가능**해요.

##### 📌 이유 2: 제약 조건이 맞는지 판단할 때 “남는 값이 없어야 한다”

- 예를 들어,

  $$
  (2 \cdot 3 - 6) = 0 \quad → 제약 만족
  $$

  $$
  (2 \cdot 3 - 5) = 1 \quad → 제약 위반
  $$

→ **“0이 된다”는 건 제약을 정확히 만족했다는 신호**

### ✅ 개념 구조 정리표

| 항목      | 의미                 | 예시 (2개 제약)             |
| --------- | -------------------- | --------------------------- |
| 제약 위치 | 제약이 적용되는 x 값 | x = 1, 2                    |
| t(x)      | 소거 다항식          | (x - 1)(x - 2)              |
| p(x)      | 증명자의 전체 다항식 | 제약을 전부 만족하는 다항식 |
| 관계식    | 증명 목표            | p(x) = t(x) · h(x)          |

- **소거 다항식**은 “특정 x 값들에서만 0이 되는 다항식”
- 이걸 통해 **제약이 만족될 위치에서만 0이 되게 하자**는 구조를 만듦
- x 값은 인덱스처럼 배정되는 값이며, x = 1, 2, ... 형태는 전혀 특별하지 않음
- 제약이 N개면 $t(x) = (x - r_1)(x - r_2)...(x - r_n)$

---

## 🔍 Q4. p(x) = ∑wᵢ·Lᵢ(x)·Rᵢ(x) − ∑wᵢ·Oᵢ(x)는 어떻게 구성되는가?

### ✅ 구조적 의미

- 첫 항: "왼쪽 × 오른쪽"
  \[
  L(x) = \sum w_i \cdot L_i(x),\quad R(x) = \sum w_i \cdot R_i(x)
  \]
  → 이 둘을 곱하면 회로의 입력 계산 결과

- 두 번째 항: "출력"
  \[
  O(x) = \sum w_i \cdot O_i(x)
  \]

- 전체:
  \[
  p(x) = L(x) \cdot R(x) - O(x)
  \]
  → 제약이 만족되면, p(x)는 0이 됨  
  → 이걸 t(x)로 나눌 수 있어야 SNARK 구조에서 유효함

---

## 🔍 Q5. 수치 예시 해설 (a = 2, b = 3, c = 6)

### ✅ 와이어 벡터

- `w = [1, 2, 3, 6]`

### ✅ 다항식 정의 (x = 1 기준)

- `L(x)` = 2 (a 위치만 참여)
- `R(x)` = 3 (b 위치만 참여)
- `O(x)` = 6 (c 위치만 참여)

### ✅ 계산

\[
p(x) = (2) \cdot (3) - (6) = 0
\Rightarrow p(1) = 0
\]

→ 이로써 \( p(x) = t(x) \cdot h(x) \) 를 만족하는 구조 성립  
→ \( t(x) = x - 1 \) 이므로 분할 가능

---

## ✅ 전체 흐름 요약

| 항목          | 내용                                                                |
| ------------- | ------------------------------------------------------------------- |
| w             | 와이어 값 전체 (증명자만 알고 있음)                                 |
| L_i, R_i, O_i | 각 와이어에 대한 다항식 (검증자가 알고 있음)                        |
| p(x)          | 전체 회로 제약을 담은 다항식                                        |
| t(x)          | 소거 다항식, 모든 제약 위치에서 0이 되는 다항식                     |
| h(x)          | p(x) ÷ t(x)의 몫 다항식                                             |
| 핵심 목적     | 증명자가 p(x) = t(x)·h(x)를 만족하는 다항식을 생성할 수 있음을 증명 |

완벽하게 옳은 방향으로 이해하고 계세요 Junseung!
이 질문은 QAP의 핵심 수학적 구조인 **vanishing polynomial**과
그 실용적 구성 이유를 깊이 이해하기 위해 꼭 짚고 넘어가야 하는 부분입니다.

---
