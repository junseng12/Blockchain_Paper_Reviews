# 📘 Delta (Δ) 보정 – ZK-SNARK에서 연산 일치를 위한 핵심 기법

---

## 🎯 WHY: 왜 Δ 보정이 필요한가?

zk-SNARK에서 영지식성을 위해 Prover는 자신의 입력값(witness)을 무작위값들 (δₗ, δᵣ, δₒ)과 섞어야 한다. 하지만 이로 인해 **원래 수식의 좌변과 우변이 더 이상 일치하지 않게 됨**:

원래는:

$$
L(s)R(s) - O(s) = t(s)h(s)
$$

하지만 증명자가 ZK를 위해 각 항에 난수를 추가하면:

$$
(L + δₗ·t)(R + δᵣ·t) - (O + δₒ·t) ≠ t·h(s)
$$

→ 좌우 불일치 발생
→ **검증 실패**

---

## ✅ HOW: 델타(Δ) 보정을 도입한 해결 방식

이를 보정하기 위해, 우변에 Δ를 추가:

$$
(L + δₗ·t)(R + δᵣ·t) - (O + δₒ·t) = t·(h(s) + Δ)
$$

### ▸ 전개하면:

좌변:

$$
L·R + δₗ·t·R + δᵣ·t·L + δₗδᵣ·t² - O - δₒ·t
$$

우변:

$$
t·h(s) + t·Δ
$$

→ 따라서 Δ는:

$$
Δ = (δₗ·R + δᵣ·L + δₗδᵣ·t - δₒ)
$$

이렇게 하면 좌우가 **일치**하게 됨

---

## ❌ 곱셈 방식은 왜 실패하는가?

곱셈 방식으로 보정하려 하면 다음과 같은 형태가 됨:

$$
Δ = \frac{δₗL · δᵣR − δₒO}{t(s)·h(s)}
$$

이 구조는 다음과 같은 **문제점**을 가짐:

1. **나눗셈 불가능**: pairing 연산은 지수승 공간에서 작동 → 나눗셈 표현이 불가능
2. **정확한 나눗셈 보장 어려움**: δₗ, δᵣ, δₒ는 랜덤이므로 분자가 t·h로 나누어 떨어질 확률은 거의 없음
3. **연산 불일치**: 우변이 이상한 소수값이 될 수 있어 검증 실패

✅ **결론: 곱셈은 pairing 기반 ZK 시스템에서 부적합**

---

## ✅ WHY 덧셈 방식은 pairing 최적화에도 적합한가?

ZK 논문 §4.12에서는 이 덧셈 기반 보정으로 인해 **pairing 연산을 단 1개로 줄이는** 데도 성공함:

기존 pairing 구조:

$$
e(g^{L(s)}, g^{R(s)}) = e(g^{t(s)}, g^{h(s)}) · e(g^{O(s)}, g)\tag{3개 pairing 필요}
$$

→ 이 구조를 다음처럼 정리:

$$
e(g^{L+δₗ·t}, g^{R+δᵣ·t}) = e(g^{t}, g^{h+Δ})\tag{1개 pairing}
$$

➡ O + δₒ·t 항은 Δ 안에 **흡수**됨 (이미 우변에서 상쇄 처리)
➡ **모든 검증을 하나의 pairing 연산으로 압축**

→ **연산량 감소 + 가스비 감소 + ZK 유지**

---

## ⚠️ δₒ = δₗ·δᵣ 로 설정하면 왜 위험한가?

1. δ들 간 **수학적 관계성 발생**: δₒ = δₗδᵣ이 되면 랜덤이 아니게 됨
2. 검증자가 pairing 연산에서 Lv, Rv, Ov에 적용할 값을 맞추려면 δₗ, δᵣ를 알아야 함 → 상호작용 필요
3. **NIZK(비대화성)** 성질 위배: ZK-SNARK는 prover와 verifier가 서로 대화하지 않아야 함

---

## 🔍 O(s) 항은 왜 pairing에서 직접 등장하지 않는가?

질문: \$(L + δₗ·t)(R + δᵣ·t) - (O + δₒ·t)\$ → pairing에서 왜 O(s) 사라짐?

👉 **Δ 항에 흡수됨**:

- 위 식 전개에서 −O − δₒ·t는 Δ에서 보상됨:

$$
Δ = δₗR + δᵣL + δₗδᵣt - δₒ
$$

→ O는 별도 pairing 항에 등장할 필요 없음
→ Δ와 함께 **간접적으로 검증**

---

## ✅ pairing 최적화 구조 전체 비교

| 방식         | pairing 수 | 구조 설명                                 | ZK 보장 | 연산 안정성 |
| ------------ | ---------- | ----------------------------------------- | ------- | ----------- |
| 기존 구조    | 3개        | e(g^L, g^R), e(g^O, g), e(g^t, g^h)       | ✅      | ✅          |
| 델타 보정 후 | 1개        | e(g^{L+δₗt}, g^{R+δᵣt}) = e(g^t, g^{h+Δ}) | ✅      | ✅          |

---

## ✨ 결론

> **Δ 보정은 난수 삽입으로 깨진 등식을 보정하면서도 pairing 연산을 1개로 줄여 효율성과 ZK를 동시에 확보하는 핵심 구조이다. 덧셈 방식만이 NIZK + pairing 호환 + 검증 간결성을 모두 만족시킨다.**
